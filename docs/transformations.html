<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Transforming/Summarizing Data</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/readable.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-1.1/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-1.1/highlight.js"></script>
<script src="site_libs/htmlwidgets-0.8/htmlwidgets.js"></script>
<script src="site_libs/viz-0.3/viz.js"></script>
<link href="site_libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="site_libs/grViz-binding-0.9.0/grViz.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="custom.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 66px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 71px;
  margin-top: -71px;
}

.section h2 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h3 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h4 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h5 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h6 {
  padding-top: 71px;
  margin-top: -71px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">How to use feedr</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li class="divider"></li>
<li>
  <a href="load.html">Loading</a>
</li>
<li>
  <a href="housekeeping.html">Housekeeping</a>
</li>
<li>
  <a href="transformations.html">Transformations</a>
</li>
<li>
  <a href="maps.html">Visualizations</a>
</li>
<li>
  <a href="about.html">About</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Transforming/Summarizing Data</h1>

</div>


<p>This section will get you started with transforming and summarizing your data from raw read data to a variety of different data types which can be used to answer different questions.</p>
<p>Here we assume that you know how to <a href="load.html">load/import</a> your data and that, if needed, you’ve cleaned up problematic <code>animal_id</code>s with the various <a href="housekeeping.html">housekeeping</a> functions.</p>
<div id="functions" class="section level2">
<h2>Functions</h2>
<p>In all cases you’ll want to use the <code>visits()</code> function first, but after that it depends on what kinda of data you want to end up with.</p>
<ol style="list-style-type: decimal">
<li><a href="#visits"><code>visits()</code></a> - Visits to a logger</li>
<li><a href="#movements"><code>move()</code></a> - Movements between loggers</li>
<li><a href="#presence"><code>presence()</code></a> - Presence around a logger</li>
<li><a href="#displacements"><code>disp()</code></a> - Displacement from a logger</li>
<li><a href="#dominance"><code>dom()</code></a> - Dominance matrices</li>
<li><a href="#activity"><code>activity()</code></a> - Activity patterns</li>
<li><a href="#dailyactivity"><code>daily()</code></a> - Daily activity patterns</li>
<li><a href="#multi">Working with multiple groups</a> - Applying transformations to different data groups simultaneously</li>
</ol>
<p>Or click on the function name below to skip directly to the function tutorial:</p>
<p><div id="htmlwidget-9de25f21d793c2250ac8" style="width:500px;height:480px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-9de25f21d793c2250ac8">{"x":{"diagram":"\ndigraph order {\n\ngraph [overlap = true, compound = true]\n\nnode[shape = Mrecord]\nedge[arrowhead = vee]\n\nvisits[label = \"visits()\", URL = \"#visits\", tooltip = \"Individual logger visits\"]\ndisp[label = \"disp()\", URL = \"#displacements\", tooltip = \"Displacements from the logger by another animal\"]\ndom[label = \"dom()\", URL = \"#dominance\", tooltip = \"Dominance indicated by displacements\"]\nmove[label = \"move()\", URL = \"#movements\", tooltip = \"Movements between loggers\"]\npresence[label = \"presence()\", URL = \"#presence\", tooltip = \"presence bouts at loggers\"]\nact[label = \"activity()\", URL = \"#acitivty\", tooltip = \"Activity scored (active/inactive)\"]\ndaily[label = \"daily()\", URL = \"#dailyactivity\", tooltip = \"Daily activity patterns\"]\n\nvisits-> {disp, move, presence}\npresence -> act\ndisp -> dom\nact -> daily\n\nmap1[label = \"map_ggmap()\", URL = \"#mapggmap\", tooltip = \"Visualize with a static map\"]\nmap2[label = \"map_leaflet()\", URL = \"#mapleaflet\", tooltip = \"Visualize with an interactive map\"]\n\n{presence; move} -> {map1; map2}\n\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script> <a id = "visits"></a></p>
</div>
<div id="visits" class="section level2">
<h2><code>visits()</code></h2>
<p>This function is designed to turn ‘raw’ data into ‘visits’ data.</p>
<p>This is always the first function you should use. Raw read data contains an individual line of data for each read event made by the RFID logger.</p>
<p>For example, if the logger was set to record ids every ~2 seconds, an individual sitting on the logger for 8 seconds followed by a 12 second gap before returning would look something like this:</p>
<pre class="r"><code>head(finches_lg)</code></pre>
<pre><code>##    animal_id                time logger_id     species sex       lon
## 1 041868E9A8 2015-10-01 17:38:52      2100 House Finch   F -120.3624
## 2 041868E9A8 2015-10-01 17:38:54      2100 House Finch   F -120.3624
## 3 041868E9A8 2015-10-01 17:38:56      2100 House Finch   F -120.3624
## 4 041868E9A8 2015-10-01 17:38:58      2100 House Finch   F -120.3624
## 5 041868E9A8 2015-10-01 17:39:00      2100 House Finch   F -120.3624
## 6 041868E9A8 2015-10-01 17:39:12      2100 House Finch   F -120.3624
##        lat
## 1 50.66896
## 2 50.66896
## 3 50.66896
## 4 50.66896
## 5 50.66896
## 6 50.66896</code></pre>
<p>The <code>visits()</code> function turns this raw data into something more practical:</p>
<pre class="r"><code>v &lt;- visits(finches_lg)
head(v)</code></pre>
<pre><code>## # A tibble: 6 × 11
##    animal_id       date               start                 end logger_id
##       &lt;fctr&gt;     &lt;date&gt;              &lt;dttm&gt;              &lt;dttm&gt;    &lt;fctr&gt;
## 1 041868E9A8 2015-10-02 2015-10-01 17:38:52 2015-10-01 17:39:00      2100
## 2 041868E9A8 2015-10-02 2015-10-01 17:39:12 2015-10-01 17:39:12      2100
## 3 041868E9A8 2015-10-02 2015-10-01 17:40:53 2015-10-01 17:40:53      2100
## 4 041868E9A8 2015-10-02 2015-10-01 17:45:00 2015-10-01 17:45:56      2700
## 5 041868E9A8 2015-10-02 2015-10-01 17:46:31 2015-10-01 17:46:31      2700
## 6 041868E9A8 2015-10-02 2015-10-01 17:51:03 2015-10-01 17:51:16      2700
##   animal_n logger_n     species   sex       lon      lat
##      &lt;int&gt;    &lt;int&gt;       &lt;chr&gt; &lt;chr&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1       11        4 House Finch     F -120.3624 50.66896
## 2       11        4 House Finch     F -120.3624 50.66896
## 3       11        4 House Finch     F -120.3624 50.66896
## 4       11        4 House Finch     F -120.3632 50.66909
## 5       11        4 House Finch     F -120.3632 50.66909
## 6       11        4 House Finch     F -120.3632 50.66909</code></pre>
<p>We can see that the first series of raw reads have been combined into one visit, starting at 2015-10-01 17:38:52 and ending at 2015-10-01 17:39:00.</p>
<p>We can also look directly at visit data for a particular individual by pulling out it’s <code>animal_id</code>:</p>
<pre class="r"><code>head(finches_lg[finches_lg$animal_id == &quot;06200004F8&quot;, ])</code></pre>
<pre><code>##        animal_id                time logger_id     species sex       lon
## 10482 06200004F8 2015-09-11 16:59:06      2100 House Finch   F -120.3624
## 10483 06200004F8 2015-09-11 16:59:09      2100 House Finch   F -120.3624
## 10484 06200004F8 2015-09-11 16:59:12      2100 House Finch   F -120.3624
## 10485 06200004F8 2015-09-11 16:59:15      2100 House Finch   F -120.3624
## 10486 06200004F8 2015-09-11 16:59:18      2100 House Finch   F -120.3624
## 10487 06200004F8 2015-09-11 16:59:21      2100 House Finch   F -120.3624
##            lat
## 10482 50.66896
## 10483 50.66896
## 10484 50.66896
## 10485 50.66896
## 10486 50.66896
## 10487 50.66896</code></pre>
<pre class="r"><code>head(v[v$animal_id == &quot;06200004F8&quot;, ])</code></pre>
<pre><code>## # A tibble: 6 × 11
##    animal_id       date               start                 end logger_id
##       &lt;fctr&gt;     &lt;date&gt;              &lt;dttm&gt;              &lt;dttm&gt;    &lt;fctr&gt;
## 1 06200004F8 2015-09-11 2015-09-11 16:59:06 2015-09-11 17:00:12      2100
## 2 06200004F8 2015-09-12 2015-09-11 17:00:17 2015-09-11 17:00:32      2100
## 3 06200004F8 2015-09-12 2015-09-11 17:01:19 2015-09-11 17:03:29      2100
## 4 06200004F8 2015-09-12 2015-09-11 17:03:33 2015-09-11 17:06:59      2100
## 5 06200004F8 2015-09-12 2015-09-12 11:53:13 2015-09-12 11:55:13      2100
## 6 06200004F8 2015-09-12 2015-09-12 11:55:17 2015-09-12 11:55:40      2100
##   animal_n logger_n     species   sex       lon      lat
##      &lt;int&gt;    &lt;int&gt;       &lt;chr&gt; &lt;chr&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1       11        4 House Finch     F -120.3624 50.66896
## 2       11        4 House Finch     F -120.3624 50.66896
## 3       11        4 House Finch     F -120.3624 50.66896
## 4       11        4 House Finch     F -120.3624 50.66896
## 5       11        4 House Finch     F -120.3624 50.66896
## 6       11        4 House Finch     F -120.3624 50.66896</code></pre>
<p>Alternatively, you can use <code>filter(v, animal_id == &quot;06200004F8&quot;)</code> from the <code>dplyr</code> package or <code>subset(v, animal_id == &quot;06200004F8&quot;)</code> which is built into R base.</p>
<p>Visits are defined by:</p>
<ul>
<li>How much time has passed between reads (<code>bw</code>)</li>
<li>A change in <code>animal_id</code> between two successive reads</li>
<li>A change in <code>logger_id</code> between two successive reads (although generally this shouldn’t be a defining point, because the <code>bw</code> should be smaller than the length of time it takes to move from one logger to another)</li>
</ul>
<p><a id = "visitsdata"></a></p>
<div id="data-returned" class="section level3">
<h3>Data returned</h3>
<p>The data returned by the visit function contains both new and old data:</p>
<ul>
<li><code>animal_id</code> id of the animal making the visit</li>
<li><code>date</code> the date of the start of the visit</li>
<li><code>start</code> the time of the start of the visit</li>
<li><code>end</code> the time of the end of the visit</li>
<li><code>logger_id</code> the id of the logger being visited</li>
<li><code>animal_n</code> the number of unique <code>animal_id</code>s in the data set</li>
<li><code>logger_n</code> the number of unique <code>logger_id</code>s in the data set</li>
</ul>
<p>Note that several of these new values could also have been obtained by hand:</p>
<pre class="r"><code>length(unique(v$animal_id))</code></pre>
<pre><code>## [1] 11</code></pre>
<pre class="r"><code>length(unique(v$logger_id))</code></pre>
<pre><code>## [1] 4</code></pre>
<p><code>species</code>, <code>sex</code>, <code>lon</code> and <code>lat</code> are all columns originally in the <code>finches_lg</code> data set, they were automatically passed through the <code>visits()</code> function. Columns of extra data that are associated with either a <code>date</code>, an <code>animal_id</code>, or a <code>logger_id</code> will always be passed through unless <code>pass = FALSE</code>:</p>
<pre class="r"><code>visits(finches_lg, pass = FALSE)</code></pre>
<pre><code>## # A tibble: 3,429 × 7
##     animal_id       date               start                 end logger_id
##        &lt;fctr&gt;     &lt;date&gt;              &lt;dttm&gt;              &lt;dttm&gt;    &lt;fctr&gt;
## 1  041868E9A8 2015-10-02 2015-10-01 17:38:52 2015-10-01 17:39:00      2100
## 2  041868E9A8 2015-10-02 2015-10-01 17:39:12 2015-10-01 17:39:12      2100
## 3  041868E9A8 2015-10-02 2015-10-01 17:40:53 2015-10-01 17:40:53      2100
## 4  041868E9A8 2015-10-02 2015-10-01 17:45:00 2015-10-01 17:45:56      2700
## 5  041868E9A8 2015-10-02 2015-10-01 17:46:31 2015-10-01 17:46:31      2700
## 6  041868E9A8 2015-10-02 2015-10-01 17:51:03 2015-10-01 17:51:16      2700
## 7  041868E9A8 2015-10-02 2015-10-01 17:51:42 2015-10-01 17:51:58      2700
## 8  041868E9A8 2015-10-02 2015-10-01 17:52:51 2015-10-01 17:53:07      2700
## 9  041868E9A8 2015-10-02 2015-10-01 17:53:41 2015-10-01 17:54:57      2700
## 10 041868E9A8 2015-10-02 2015-10-01 17:56:42 2015-10-01 17:56:42      2700
##    animal_n logger_n
##       &lt;int&gt;    &lt;int&gt;
## 1        11        4
## 2        11        4
## 3        11        4
## 4        11        4
## 5        11        4
## 6        11        4
## 7        11        4
## 8        11        4
## 9        11        4
## 10       11        4
## # ... with 3,419 more rows</code></pre>
</div>
<div id="bw" class="section level3">
<h3><code>bw</code></h3>
<p>Depending on the interval between reads in your RFID logger, you may have to adjust the value of <code>bw</code> which specifies how many seconds between reads separates two visits. The default is 3 seconds, but if your loggers scan at a slower interval, you will need to adjust the <code>bw</code> argument:</p>
<pre class="r"><code>visits(finches_lg, bw = 15)</code></pre>
<pre><code>## # A tibble: 2,465 × 11
##     animal_id       date               start                 end logger_id
##        &lt;fctr&gt;     &lt;date&gt;              &lt;dttm&gt;              &lt;dttm&gt;    &lt;fctr&gt;
## 1  041868E9A8 2015-10-02 2015-10-01 17:38:52 2015-10-01 17:39:12      2100
## 2  041868E9A8 2015-10-02 2015-10-01 17:40:53 2015-10-01 17:40:53      2100
## 3  041868E9A8 2015-10-02 2015-10-01 17:45:00 2015-10-01 17:45:56      2700
## 4  041868E9A8 2015-10-02 2015-10-01 17:46:31 2015-10-01 17:46:31      2700
## 5  041868E9A8 2015-10-02 2015-10-01 17:51:03 2015-10-01 17:51:16      2700
## 6  041868E9A8 2015-10-02 2015-10-01 17:51:42 2015-10-01 17:51:58      2700
## 7  041868E9A8 2015-10-02 2015-10-01 17:52:51 2015-10-01 17:53:07      2700
## 8  041868E9A8 2015-10-02 2015-10-01 17:53:41 2015-10-01 17:54:57      2700
## 9  041868E9A8 2015-10-02 2015-10-01 17:56:42 2015-10-01 17:56:42      2700
## 10 041868E9A8 2015-10-02 2015-10-02 10:57:00 2015-10-02 10:57:14      2200
##    animal_n logger_n     species   sex       lon      lat
##       &lt;int&gt;    &lt;int&gt;       &lt;chr&gt; &lt;chr&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1        11        4 House Finch     F -120.3624 50.66896
## 2        11        4 House Finch     F -120.3624 50.66896
## 3        11        4 House Finch     F -120.3632 50.66909
## 4        11        4 House Finch     F -120.3632 50.66909
## 5        11        4 House Finch     F -120.3632 50.66909
## 6        11        4 House Finch     F -120.3632 50.66909
## 7        11        4 House Finch     F -120.3632 50.66909
## 8        11        4 House Finch     F -120.3632 50.66909
## 9        11        4 House Finch     F -120.3632 50.66909
## 10       11        4 House Finch     F -120.3612 50.66778
## # ... with 2,455 more rows</code></pre>
</div>
<div id="impossiblemissing-visits" class="section level3">
<h3>Impossible/missing visits</h3>
<p>You should also be aware of ‘impossible visits’. These may occur if the internal clocks on your RFIDs are not in sync, or if your loggers are very close to each other. An impossible visit is when an individual animal is detected at two different loggers within 2 seconds (the default) of each other. Unless your loggers are REALLY close to each other, this is highly unlikely.</p>
<p>Because both missing values (NAs) and impossible visits likely indicate a greater underlying problem, you have to specifically tell the function to ignore them (or omit them, in the case of NAs).</p>
<pre class="r"><code>v &lt;- visits(finches_lg, allow_imp = TRUE, na_rm = TRUE)</code></pre>
<p>You can define the minimum number of seconds needed to travel between loggers to specify which visits should be considered impossible. For example, if we say that it must take animals at least 3 minutes to travel between loggers, any visit made to a different logger within 3 minutes would be defined as ‘impossible’:</p>
<pre class="r"><code>visits(finches_lg, bw_imp = 180)</code></pre>
<pre><code>## Error in visits(finches_lg, bw_imp = 180): Impossible visits found, no specification for how to handle:
## 
## Individual(s) detected at 2+ loggers within 180s.
## Decrease the `bw_imp` argument, remove these reads, or
## allow impossible visits (allow_imp = TRUE) and try again.
## 
##        animal_id                time logger_id     species sex       lon
## 9239  0620000477 2015-09-28 07:07:19      2700 House Finch   F -120.3632
## 9240  0620000477 2015-09-28 07:09:32      2100 House Finch   F -120.3624
## 13755 06200004F8 2015-09-16 17:40:19      2100 House Finch   F -120.3624
## 13756 06200004F8 2015-09-16 17:42:22      2700 House Finch   F -120.3632
## 13779 06200004F8 2015-09-16 17:44:11      2700 House Finch   F -120.3632
##            lat       date
## 9239  50.66909 2015-09-28
## 9240  50.66896 2015-09-28
## 13755 50.66896 2015-09-17
## 13756 50.66909 2015-09-17
## 13779 50.66909 2015-09-17</code></pre>
</div>
<div id="summarizing" class="section level3">
<h3>Summarizing</h3>
<p>Visit data is the starting block of all other transformations, but you can also summarize and analyze visit data in itself.</p>
<p>For example, if we want to create daily summaries of the number of visits made and loggers used per <code>animal_id</code>, we could use the <code>dplyr</code> package (part of the <a href="http://tidyverse.org/"><code>tidyverse</code> family of packages</a>).</p>
<p>Currently we have data on the total number of loggers in the data set, but what if we wanted to know how many loggers each individual used?</p>
<pre class="r"><code>library(dplyr)
visit_summary &lt;- v %&gt;%
  group_by(animal_id) %&gt;%
  summarize(n_visits = length(start),
            n_loggers = length(unique(logger_id)),
            n_days = length(unique(date)),
            mean_visit_length = mean(as.numeric(difftime(end, start, units = &quot;sec&quot;))))
visit_summary</code></pre>
<pre><code>## # A tibble: 11 × 5
##     animal_id n_visits n_loggers n_days mean_visit_length
##        &lt;fctr&gt;    &lt;int&gt;     &lt;int&gt;  &lt;int&gt;             &lt;dbl&gt;
## 1  041868E9A8      185         3      7          9.864865
## 2  041869123C       34         1      2          3.264706
## 3  06200003AA      346         2     21         20.329480
## 4  0620000400       32         2      5         11.187500
## 5  062000043E        1         1      1          2.000000
## 6  0620000477      189         2     10         59.968254
## 7  06200004F8     1419         4     42         30.014799
## 8  0620000500     1056         3     36         15.424242
## 9  0620000513        5         1      1         51.800000
## 10 0620000514      146         3     17         15.369863
## 11 0620000520       16         1      2         10.625000</code></pre>
<p><strong>A Side Note</strong><br />
This bit of code uses a slightly advanced technique called ‘pipes’: <code>%&gt;%</code> These allow you to pass the output from one line directly down to the next line where it becomes the first (and hidden) argument. In this case, the first line specifies our visits data frame <code>v</code>, this then becomes the input for <code>group_by()</code>. The output of <code>group_by()</code> then becomes the input for <code>summarize()</code>. This makes your coding more efficient but may take a bit of getting used to.</p>
<p>You can find an in-depth look at <code>dplyr</code>, pipes and related packages here: <a href="http://r4ds.had.co.nz/transform.html" class="uri">http://r4ds.had.co.nz/transform.html</a></p>
<p>For reference, you can achieve the same effect without pipes:</p>
<pre class="r"><code>library(dplyr)
visit_summary &lt;- group_by(v, animal_id)
visit_summary &lt;- summarize(visit_summary,
               n_visits = length(start),
               n_loggers = length(unique(logger_id)),
               n_days = length(unique(date)),
               mean_visit_length = mean(as.numeric(difftime(end, start, units = &quot;sec&quot;))))
visit_summary</code></pre>
<pre><code>## # A tibble: 11 × 5
##     animal_id n_visits n_loggers n_days mean_visit_length
##        &lt;fctr&gt;    &lt;int&gt;     &lt;int&gt;  &lt;int&gt;             &lt;dbl&gt;
## 1  041868E9A8      185         3      7          9.864865
## 2  041869123C       34         1      2          3.264706
## 3  06200003AA      346         2     21         20.329480
## 4  0620000400       32         2      5         11.187500
## 5  062000043E        1         1      1          2.000000
## 6  0620000477      189         2     10         59.968254
## 7  06200004F8     1419         4     42         30.014799
## 8  0620000500     1056         3     36         15.424242
## 9  0620000513        5         1      1         51.800000
## 10 0620000514      146         3     17         15.369863
## 11 0620000520       16         1      2         10.625000</code></pre>
<p>The result is a data frame with one row for each <code>animal_id</code>, giving us information on how many loggers that animal has used, how many visits they have made, over how many days, and what the average visit length was.</p>
<p>If we wanted to plot this data, the package <code>ggplot2</code> is a great option:</p>
<pre class="r"><code>library(ggplot2)
ggplot(data = visit_summary, aes(x = animal_id, y = mean_visit_length)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) + #rotate/shift id labels
  geom_bar(stat = &quot;identity&quot;) + # Create bars
  labs(x = &quot;Animal ID&quot;, y = &quot;Average visit length (s)&quot;) # Make labels pretty</code></pre>
<p><img src="transformations_files/figure-html/unnamed-chunk-11-1.png" width="576" /></p>
<table>
<tbody>
<tr class="odd">
<td align="left">Back to <a href="#top">top</a></td>
</tr>
</tbody>
</table>
<p><a id = "movements"></a></p>
</div>
</div>
<div id="move" class="section level2">
<h2><code>move()</code></h2>
<p>This function is designed to turn ‘Visit’ data into ‘Movement’ data.</p>
<p><strong>Movements</strong> are defined as trips between loggers (i.e. a event when a visit from one <code>animal_id</code> occurs at a different logger from the previous visit by that particular <code>animal_id</code>).</p>
<pre class="r"><code>v &lt;- visits(finches_lg, bw = 5)
m &lt;- move(v)
head(m)</code></pre>
<pre><code>## # A tibble: 6 × 15
##    animal_id       date                time logger_id direction move_id
##       &lt;fctr&gt;     &lt;date&gt;              &lt;dttm&gt;    &lt;fctr&gt;     &lt;chr&gt;   &lt;int&gt;
## 1 041868E9A8 2015-10-02 2015-10-01 17:40:53      2100      left       1
## 2 041868E9A8 2015-10-02 2015-10-01 17:45:00      2700   arrived       1
## 3 041868E9A8 2015-10-02 2015-10-01 17:56:42      2700      left       2
## 4 041868E9A8 2015-10-02 2015-10-02 10:57:00      2200   arrived       2
## 5 041868E9A8 2015-10-06 2015-10-06 14:24:50      2200      left       3
## 6 041868E9A8 2015-10-06 2015-10-06 16:05:40      2700   arrived       3
##    move_dir move_path    strength animal_n logger_n     species   sex
##      &lt;fctr&gt;    &lt;fctr&gt;       &lt;dbl&gt;    &lt;int&gt;    &lt;int&gt;       &lt;chr&gt; &lt;chr&gt;
## 1 2100_2700 2100_2700 14.57489879       11        4 House Finch     F
## 2 2100_2700 2100_2700 14.57489879       11        4 House Finch     F
## 3 2700_2200 2200_2700  0.05880623       11        4 House Finch     F
## 4 2700_2200 2200_2700  0.05880623       11        4 House Finch     F
## 5 2200_2700 2200_2700  0.59504132       11        4 House Finch     F
## 6 2200_2700 2200_2700  0.59504132       11        4 House Finch     F
##         lon      lat
##       &lt;dbl&gt;    &lt;dbl&gt;
## 1 -120.3624 50.66896
## 2 -120.3632 50.66909
## 3 -120.3632 50.66909
## 4 -120.3612 50.66778
## 5 -120.3612 50.66778
## 6 -120.3632 50.66909</code></pre>
<div id="data-returned-1" class="section level3">
<h3>Data returned</h3>
<p>This function returns a lot of information for each movement event. Note, in particular, that each movement event results in two rows of data: leaving and arriving</p>
<ul>
<li><code>animal_id</code> id of the animal making the move</li>
<li><code>date</code> the date of the event (either arriving or leaving)</li>
<li><code>time</code> the time of the event (either arriving or leaving)</li>
<li><code>logger_id</code> the logger left or arrived at</li>
<li><code>direction</code> leaving or arriving</li>
<li><code>move_id</code> for each individual, a unique number tying the two events (leaving/arriving) of the movement together</li>
<li><code>move_dir</code> category indicating direction of the movement and the loggers involved</li>
<li><code>move_path</code> category indicating the loggers involved (no directionality)</li>
<li><code>strength</code> a metric indicating how ‘easily’ individuals move been loggers, it represents 1/time between loggers</li>
</ul>
<p><code>animal_n</code>, <code>logger_n</code>, <code>species</code>, <code>sex</code>, <code>lon</code>, and <code>lat</code> are extra columns passed through (see <a href="#visitsdata">visits data</a> for more information).</p>
</div>
<div id="include-all" class="section level3">
<h3>Include all</h3>
<p>In this case, four <code>animal_id</code> have been omitted because they never moved between loggers. While the id is retained in the <em>levels</em> of the factor, <code>animal_id</code>, it is not present in the data frame:</p>
<pre class="r"><code>unique(m$animal_id)         # The animal_ids currently in the movement data</code></pre>
<pre><code>## [1] 041868E9A8 06200003AA 0620000400 0620000477 06200004F8 0620000500
## [7] 0620000514
## 11 Levels: 041868E9A8 041869123C 06200003AA 0620000400 ... 0620000520</code></pre>
<pre class="r"><code>length(unique(m$animal_id)) # The number of animal_ids currently in the data</code></pre>
<pre><code>## [1] 7</code></pre>
<pre class="r"><code>length(levels(m$animal_id)) # The number of levels of animal_id</code></pre>
<pre><code>## [1] 11</code></pre>
<p>However, if you wanted to retain all animals in the data set, regardless of whether they moved or not (for example, if you wanted to look at the likelihood of moving between loggers), you can specify that:</p>
<pre class="r"><code>m &lt;- move(v, all = TRUE)

unique(m$animal_id)         # The animal_ids currently in the movement data</code></pre>
<pre><code>##  [1] 041868E9A8 041869123C 06200003AA 0620000400 062000043E 0620000477
##  [7] 06200004F8 0620000500 0620000513 0620000514 0620000520
## 11 Levels: 041868E9A8 041869123C 06200003AA 0620000400 ... 0620000520</code></pre>
<pre class="r"><code>length(unique(m$animal_id)) # The number of animal_ids currently in the data</code></pre>
<pre><code>## [1] 11</code></pre>
<pre class="r"><code>length(levels(m$animal_id)) # The number of levels of animal_id</code></pre>
<pre><code>## [1] 11</code></pre>
<p>Here we’ve told R that an additional parameter for <code>move()</code> is <code>all = TRUE</code>. animals which never visit more than one logger will have NA’s in the data frame:</p>
<pre class="r"><code>m[is.na(m$direction), ]</code></pre>
<pre><code>## # A tibble: 4 × 15
##    animal_id   date   time logger_id direction move_id move_dir move_path
##       &lt;fctr&gt; &lt;date&gt; &lt;dttm&gt;    &lt;fctr&gt;     &lt;chr&gt;   &lt;dbl&gt;   &lt;fctr&gt;    &lt;fctr&gt;
## 1 041869123C   &lt;NA&gt;   &lt;NA&gt;        NA      &lt;NA&gt;      NA       NA        NA
## 2 062000043E   &lt;NA&gt;   &lt;NA&gt;        NA      &lt;NA&gt;      NA       NA        NA
## 3 0620000513   &lt;NA&gt;   &lt;NA&gt;        NA      &lt;NA&gt;      NA       NA        NA
## 4 0620000520   &lt;NA&gt;   &lt;NA&gt;        NA      &lt;NA&gt;      NA       NA        NA
##   strength animal_n logger_n species   sex   lon   lat
##      &lt;dbl&gt;    &lt;int&gt;    &lt;int&gt;   &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1       NA       NA       NA    &lt;NA&gt;     M    NA    NA
## 2       NA       NA       NA    &lt;NA&gt;     M    NA    NA
## 3       NA       NA       NA    &lt;NA&gt;     F    NA    NA
## 4       NA       NA       NA    &lt;NA&gt;     M    NA    NA</code></pre>
</div>
<div id="summarizing-1" class="section level3">
<h3>Summarizing</h3>
<p>Once again we can summarize movement data using the <code>dplyr</code> package.</p>
<p>Are certain paths used more often?</p>
<pre class="r"><code>move_summary &lt;- m %&gt;%
  group_by(move_path, logger_id) %&gt;%
  summarize(n = length(move_path))
move_summary</code></pre>
<pre><code>## Source: local data frame [11 x 3]
## Groups: move_path [?]
## 
##    move_path logger_id     n
##       &lt;fctr&gt;    &lt;fctr&gt; &lt;int&gt;
## 1  2100_2200      2100    12
## 2  2100_2200      2200    12
## 3  2100_2400      2100     1
## 4  2100_2400      2400     1
## 5  2100_2700      2100   159
## 6  2100_2700      2700   159
## 7  2200_2700      2200    15
## 8  2200_2700      2700    15
## 9  2400_2700      2400     1
## 10 2400_2700      2700     1
## 11        NA        NA     4</code></pre>
<p>The NAs reflect the four individuals that did not move.</p>
<p>Note that because there are two rows per movement event (leaving and arriving), we group by logger_id to summarize individually by logger (resulting in duplicate <code>n</code>s per <code>move_path</code>. This will account for the 2 rows and keep logger ids in the final data frame (required for mapping later on).</p>
<p>However, if you only wanted <code>move_path</code> and <code>n</code>, you could simply omit <code>logger_id</code> and remove duplicates:</p>
<pre class="r"><code>move_summary %&gt;% 
  select(-logger_id) %&gt;%
  unique()</code></pre>
<pre><code>## Source: local data frame [6 x 2]
## Groups: move_path [6]
## 
##   move_path     n
##      &lt;fctr&gt; &lt;int&gt;
## 1 2100_2200    12
## 2 2100_2400     1
## 3 2100_2700   159
## 4 2200_2700    15
## 5 2400_2700     1
## 6        NA     4</code></pre>
<pre class="r"><code>ggplot(data = move_summary, aes(x = move_path, y = n)) +
  geom_bar(stat = &quot;identity&quot;)</code></pre>
<p><img src="transformations_files/figure-html/unnamed-chunk-17-1.png" width="576" /></p>
<p>Are certain directions on particular paths used more often? (i.e. do birds go back and forth or do they circle around?)</p>
<pre class="r"><code>move_summary &lt;- m %&gt;%
  group_by(logger_id, move_path, move_dir) %&gt;%
  summarize(n = length(move_path))
head(move_summary)</code></pre>
<pre><code>## Source: local data frame [6 x 4]
## Groups: logger_id, move_path [4]
## 
##   logger_id move_path  move_dir     n
##      &lt;fctr&gt;    &lt;fctr&gt;    &lt;fctr&gt; &lt;int&gt;
## 1      2100 2100_2200 2200_2100     6
## 2      2100 2100_2200 2100_2200     6
## 3      2100 2100_2400 2100_2400     1
## 4      2100 2100_2700 2700_2100    79
## 5      2100 2100_2700 2100_2700    80
## 6      2200 2100_2200 2200_2100     6</code></pre>
<pre class="r"><code>ggplot(data = move_summary, aes(x = move_path, y = n, fill = move_dir)) +
  geom_bar(stat = &quot;identity&quot;, position = &quot;dodge&quot;, colour = &quot;black&quot;)</code></pre>
<p><img src="transformations_files/figure-html/unnamed-chunk-19-1.png" width="576" /></p>
<p>Is there a relationship between use of a path and the average ‘strength’?</p>
<pre class="r"><code>move_summary &lt;- m %&gt;%
  group_by(logger_id, move_path) %&gt;%
  summarize(n = length(move_path),
            strength = mean(strength, na.rm = TRUE))
move_summary</code></pre>
<pre><code>## Source: local data frame [11 x 4]
## Groups: logger_id [?]
## 
##    logger_id move_path     n   strength
##       &lt;fctr&gt;    &lt;fctr&gt; &lt;int&gt;      &lt;dbl&gt;
## 1       2100 2100_2200    12  1.2150942
## 2       2100 2100_2400     1  3.9560440
## 3       2100 2100_2700   159 10.5643650
## 4       2200 2100_2200    12  1.2150942
## 5       2200 2200_2700    15  0.8765755
## 6       2400 2100_2400     1  3.9560440
## 7       2400 2400_2700     1  0.1445725
## 8       2700 2100_2700   159 10.5643650
## 9       2700 2200_2700    15  0.8765755
## 10      2700 2400_2700     1  0.1445725
## 11        NA        NA     4        NaN</code></pre>
<pre class="r"><code>ggplot(data = move_summary, aes(x = strength, y = n)) +
  geom_point() +
  stat_smooth(method = &quot;lm&quot;) # add a regression line w/ standard error</code></pre>
<pre><code>## Warning: Removed 1 rows containing non-finite values (stat_smooth).</code></pre>
<pre><code>## Warning: Removed 1 rows containing missing values (geom_point).</code></pre>
<p><img src="transformations_files/figure-html/unnamed-chunk-21-1.png" width="768" /></p>
<p>Do some animals move more than others?</p>
<pre class="r"><code>move_summary &lt;- m %&gt;%
  group_by(animal_id) %&gt;%
  summarize(n = length(move_path[!is.na(move_path)])) # Number of movements omitting NAs
move_summary</code></pre>
<pre><code>## # A tibble: 11 × 2
##     animal_id     n
##        &lt;fctr&gt; &lt;int&gt;
## 1  041868E9A8     8
## 2  041869123C     0
## 3  06200003AA    12
## 4  0620000400     6
## 5  062000043E     0
## 6  0620000477    16
## 7  06200004F8   158
## 8  0620000500   148
## 9  0620000513     0
## 10 0620000514    28
## 11 0620000520     0</code></pre>
<p>Note that we have some zeros because we made sure to include all individuals in the analysis (<code>all = TRUE</code>, above) and because we specified <code>summarize()</code> to count only non-NA paths (<code>move_path[!is.na(move_path)]</code>).</p>
<pre class="r"><code>ggplot(data = move_summary, aes(x = animal_id, y = n)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) + #rotate and shift id labels
  geom_bar(stat = &quot;identity&quot;) </code></pre>
<p><img src="transformations_files/figure-html/unnamed-chunk-23-1.png" width="576" /></p>
<table>
<tbody>
<tr class="odd">
<td align="left">Back to <a href="#top">top</a></td>
</tr>
</tbody>
</table>
<p><a id = "presence"></a></p>
</div>
</div>
<div id="presence" class="section level2">
<h2><code>presence()</code></h2>
<p>This function is designed to turn ‘Visit’ data into ‘Presence’ data.</p>
<p><strong>Presence</strong> reflects blocks of time in which an animal visited a given logger regularly. Essentially, presence is defined as a series of visits, and can overlap with presence of other animals (this differs from <a href="#visits">visits</a>, as normally one individual’s visits cannot overlap with another). Presence near a logger ends when the individual moves to another logger or when a particular amount of time has passed without a visit (the time between visits, <code>bw</code>, 15 min by default).</p>
<pre class="r"><code>v &lt;- visits(finches_lg, bw = 5)
p &lt;- presence(v)
head(p)</code></pre>
<pre><code>## # A tibble: 6 × 12
##    animal_id       date logger_id               start                 end
##       &lt;fctr&gt;     &lt;date&gt;    &lt;fctr&gt;              &lt;dttm&gt;              &lt;dttm&gt;
## 1 041868E9A8 2015-10-02      2100 2015-10-01 17:38:52 2015-10-01 17:40:53
## 2 041868E9A8 2015-10-02      2700 2015-10-01 17:45:00 2015-10-01 17:56:42
## 3 041868E9A8 2015-10-02      2200 2015-10-02 10:57:00 2015-10-02 11:11:43
## 4 041868E9A8 2015-10-02      2200 2015-10-02 12:45:37 2015-10-02 13:06:27
## 5 041868E9A8 2015-10-02      2200 2015-10-02 14:22:58 2015-10-02 14:27:30
## 6 041868E9A8 2015-10-02      2200 2015-10-02 15:33:42 2015-10-02 15:37:25
##      length animal_n logger_n     species   sex       lon      lat
##       &lt;dbl&gt;    &lt;int&gt;    &lt;int&gt;       &lt;chr&gt; &lt;chr&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1  2.016667       11        4 House Finch     F -120.3624 50.66896
## 2 11.700000       11        4 House Finch     F -120.3632 50.66909
## 3 14.716667       11        4 House Finch     F -120.3612 50.66778
## 4 20.833333       11        4 House Finch     F -120.3612 50.66778
## 5  4.533333       11        4 House Finch     F -120.3612 50.66778
## 6  3.716667       11        4 House Finch     F -120.3612 50.66778</code></pre>
<div id="data-returned-2" class="section level3">
<h3>Data returned</h3>
<ul>
<li><code>animal_id</code> id of the animal present</li>
<li><code>date</code> the date of the start of the event</li>
<li><code>logger_id</code> the logger involved</li>
<li><code>start</code> the start time of the event</li>
<li><code>end</code> the end time of the event</li>
<li><code>length</code> the length of the event in minutes</li>
</ul>
<p><code>animal_n</code>, <code>logger_n</code>, <code>species</code>, <code>sex</code>, <code>lon</code>, and <code>lat</code> are extra columns passed through (see <a href="#visitsdata">visits data</a> for more information).</p>
</div>
<div id="bw-1" class="section level3">
<h3><code>bw</code></h3>
<p>The user of the function may define what the minimum amount of time between visits should be. Ground truthing could help establish the amount of time an individual spends near a logger without making a logger visit and could be used to determine this cutoff time.</p>
<p>Note that the units for <code>bw</code> when defining <a href="#visits">visits</a> is in seconds, while the units for <code>bw</code> when defining presence is in minutes. This reflects the different scales of the two functions.</p>
<pre class="r"><code>v &lt;- visits(finches_lg, bw = 5)
p &lt;- presence(v, bw = 20)  # Within 20 min
head(p)</code></pre>
<pre><code>## # A tibble: 6 × 12
##    animal_id       date logger_id               start                 end
##       &lt;fctr&gt;     &lt;date&gt;    &lt;fctr&gt;              &lt;dttm&gt;              &lt;dttm&gt;
## 1 041868E9A8 2015-10-02      2100 2015-10-01 17:38:52 2015-10-01 17:40:53
## 2 041868E9A8 2015-10-02      2700 2015-10-01 17:45:00 2015-10-01 17:56:42
## 3 041868E9A8 2015-10-02      2200 2015-10-02 10:57:00 2015-10-02 11:11:43
## 4 041868E9A8 2015-10-02      2200 2015-10-02 12:45:37 2015-10-02 13:06:27
## 5 041868E9A8 2015-10-02      2200 2015-10-02 14:22:58 2015-10-02 14:27:30
## 6 041868E9A8 2015-10-02      2200 2015-10-02 15:33:42 2015-10-02 15:37:25
##      length animal_n logger_n     species   sex       lon      lat
##       &lt;dbl&gt;    &lt;int&gt;    &lt;int&gt;       &lt;chr&gt; &lt;chr&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1  2.016667       11        4 House Finch     F -120.3624 50.66896
## 2 11.700000       11        4 House Finch     F -120.3632 50.66909
## 3 14.716667       11        4 House Finch     F -120.3612 50.66778
## 4 20.833333       11        4 House Finch     F -120.3612 50.66778
## 5  4.533333       11        4 House Finch     F -120.3612 50.66778
## 6  3.716667       11        4 House Finch     F -120.3612 50.66778</code></pre>
<pre class="r"><code>v &lt;- visits(finches_lg, bw = 5)
p &lt;- presence(v, bw = 90)  # Within 1.5 h
head(p)</code></pre>
<pre><code>## # A tibble: 6 × 12
##    animal_id       date logger_id               start                 end
##       &lt;fctr&gt;     &lt;date&gt;    &lt;fctr&gt;              &lt;dttm&gt;              &lt;dttm&gt;
## 1 041868E9A8 2015-10-02      2100 2015-10-01 17:38:52 2015-10-01 17:40:53
## 2 041868E9A8 2015-10-02      2700 2015-10-01 17:45:00 2015-10-01 17:56:42
## 3 041868E9A8 2015-10-02      2200 2015-10-02 10:57:00 2015-10-02 11:11:43
## 4 041868E9A8 2015-10-02      2200 2015-10-02 12:45:37 2015-10-02 15:37:25
## 5 041868E9A8 2015-10-03      2200 2015-10-02 17:44:14 2015-10-02 17:50:15
## 6 041868E9A8 2015-10-03      2200 2015-10-03 10:25:06 2015-10-03 10:26:04
##        length animal_n logger_n     species   sex       lon      lat
##         &lt;dbl&gt;    &lt;int&gt;    &lt;int&gt;       &lt;chr&gt; &lt;chr&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1   2.0166667       11        4 House Finch     F -120.3624 50.66896
## 2  11.7000000       11        4 House Finch     F -120.3632 50.66909
## 3  14.7166667       11        4 House Finch     F -120.3612 50.66778
## 4 171.8000000       11        4 House Finch     F -120.3612 50.66778
## 5   6.0166667       11        4 House Finch     F -120.3612 50.66778
## 6   0.9666667       11        4 House Finch     F -120.3612 50.66778</code></pre>
<p>The <code>bw</code> parameter can also be omitted entirely:</p>
<pre class="r"><code>v &lt;- visits(finches_lg, bw = 5)
p &lt;- presence(v, bw = NULL)
head(p)</code></pre>
<pre><code>## # A tibble: 6 × 12
##    animal_id       date logger_id               start                 end
##       &lt;fctr&gt;     &lt;date&gt;    &lt;fctr&gt;              &lt;dttm&gt;              &lt;dttm&gt;
## 1 041868E9A8 2015-10-02      2100 2015-10-01 17:38:52 2015-10-01 17:40:53
## 2 041868E9A8 2015-10-02      2700 2015-10-01 17:45:00 2015-10-01 17:56:42
## 3 041868E9A8 2015-10-02      2200 2015-10-02 10:57:00 2015-10-06 14:24:50
## 4 041868E9A8 2015-10-06      2700 2015-10-06 16:05:40 2015-10-06 16:08:29
## 5 041868E9A8 2015-10-06      2200 2015-10-06 16:14:47 2015-10-09 14:11:08
## 6 041869123C 2015-10-15      2200 2015-10-15 10:16:52 2015-10-16 09:27:48
##        length animal_n logger_n     species   sex       lon      lat
##         &lt;dbl&gt;    &lt;int&gt;    &lt;int&gt;       &lt;chr&gt; &lt;chr&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1    2.016667       11        4 House Finch     F -120.3624 50.66896
## 2   11.700000       11        4 House Finch     F -120.3632 50.66909
## 3 5967.833333       11        4 House Finch     F -120.3612 50.66778
## 4    2.816667       11        4 House Finch     F -120.3632 50.66909
## 5 4196.350000       11        4 House Finch     F -120.3612 50.66778
## 6 1390.933333       11        4 House Finch     M -120.3612 50.66778</code></pre>
<p>When <code>bw = NULL</code> only a move to a different logger will initiate a new presence bout. Therefore this identifies how much time passes before a new logger is visited. The end time reflects the time of the final visit to that logger before moving to a new logger, but if an individual were to visit logger A all day on day 1 and disappear on day 2 and then make one visit to logger A on day 3 before moving immediately to logger B, that first bout of ‘presence’ would be considered two days long, whereas in reality, the individual did not make any visits on one of those days.</p>
</div>
<div id="summarizing-2" class="section level3">
<h3>Summarizing</h3>
<p>What’s the average time present for each individual?</p>
<pre class="r"><code>v &lt;- visits(finches_lg, bw = 5)
p &lt;- presence(v)

presence_summary &lt;- p %&gt;%
  group_by(animal_id) %&gt;%
  summarize(n = length(start),          ## how many rows = number of events
            mean_length = mean(length)) ## mean length of events

presence_summary</code></pre>
<pre><code>## # A tibble: 11 × 3
##     animal_id     n mean_length
##        &lt;fctr&gt; &lt;int&gt;       &lt;dbl&gt;
## 1  041868E9A8    28  7.37500000
## 2  041869123C     2 11.92500000
## 3  06200003AA    66  5.07752525
## 4  0620000400     8  4.07500000
## 5  062000043E     1  0.03333333
## 6  0620000477    37  6.05180180
## 7  06200004F8   270  7.27419753
## 8  0620000500   202  5.30445545
## 9  0620000513     1  6.10000000
## 10 0620000514    48  4.31354167
## 11 0620000520     2  4.86666667</code></pre>
<p>Is there a relationship between the number and length of presence bouts?</p>
<pre class="r"><code>ggplot(data = presence_summary, aes(x = n, y = mean_length)) +
  geom_point()</code></pre>
<p><img src="transformations_files/figure-html/unnamed-chunk-28-1.png" width="768" /></p>
<p>Do animals spend more time around certain loggers?</p>
<pre class="r"><code>presence_summary &lt;- p %&gt;%
  group_by(logger_id) %&gt;%
  summarize(n = length(start),
            mean_length = mean(length),
            se_length = sd(length)/sqrt(n))

presence_summary</code></pre>
<pre><code>## # A tibble: 4 × 4
##   logger_id     n mean_length se_length
##      &lt;fctr&gt; &lt;int&gt;       &lt;dbl&gt;     &lt;dbl&gt;
## 1      2100   272    6.447059 0.4577221
## 2      2200    77    5.318831 0.6708895
## 3      2400     1    2.033333        NA
## 4      2700   315    6.080159 0.3474290</code></pre>
<pre class="r"><code>ggplot(data = presence_summary, aes(x = logger_id, y = mean_length, fill = logger_id)) +
  geom_bar(stat = &quot;identity&quot;) +
  geom_errorbar(aes(ymin = mean_length - se_length, 
                    ymax = mean_length + se_length), width = 0.25)</code></pre>
<pre><code>## Warning: Removed 1 rows containing missing values (geom_errorbar).</code></pre>
<p><img src="transformations_files/figure-html/unnamed-chunk-29-1.png" width="768" /></p>
<p>Note that there is only one bout of presence around logger 2400, hence the lack of errorbars.</p>
<table>
<tbody>
<tr class="odd">
<td align="left">Back to <a href="#top">top</a></td>
</tr>
</tbody>
</table>
<p><a id = "displacements"></a></p>
</div>
</div>
<div id="disp" class="section level2">
<h2><code>disp()</code></h2>
<p>This function is designed to turn ‘visit’ data into ‘displacements’ data.</p>
<p><strong>Displacements</strong> are events when one animal leaves the logger and is replaced by another animal within a certain, defined, time span.</p>
<p>In theory, we assume this is due to the arrival of a more dominant animal. Displacements events might therefore lead to information on relative dominance of different individuals (see <a href="#dominance"><code>dom()</code> function</a>).</p>
<blockquote>
<p><strong>Disclaimer!</strong><br />
It is important to ground-truth this assumption because, depending on species, displacements may not necessarily represent dominance. For example, in the case of black-capped chickadees, if the dominant male is using the logger, subsequent users of the logger may actually arrive and depart in descending order of rank. In this case, apparent ‘displacements’ are not displacements at all.</p>
</blockquote>
<pre class="r"><code>v &lt;- visits(finches_lg, bw = 5)
d &lt;- disp(v)
names(d)</code></pre>
<pre><code>## [1] &quot;displacements&quot; &quot;summaries&quot;     &quot;interactions&quot;</code></pre>
<div id="data-returned-3" class="section level3">
<h3>Data returned</h3>
<p>This function returns a list with three different types of displacement information: <code>displacements</code>, <code>summaries</code>, and <code>interactions</code>.</p>
<pre class="r"><code>head(d$displacements)</code></pre>
<pre><code>## # A tibble: 6 × 12
##    animal_id       date                left             arrived logger_id
##       &lt;fctr&gt;     &lt;date&gt;              &lt;dttm&gt;              &lt;dttm&gt;    &lt;fctr&gt;
## 1 06200004F8 2015-09-12 2015-09-12 15:51:41 2015-09-12 15:51:44      2100
## 2 0620000500 2015-09-12 2015-09-12 15:51:41 2015-09-12 15:51:44      2100
## 3 06200004F8 2015-09-13 2015-09-13 15:17:59 2015-09-13 15:18:02      2100
## 4 0620000500 2015-09-13 2015-09-13 15:17:59 2015-09-13 15:18:02      2100
## 5 06200004F8 2015-09-14 2015-09-14 13:48:02 2015-09-14 13:48:06      2100
## 6 0620000500 2015-09-14 2015-09-14 13:48:02 2015-09-14 13:48:06      2100
##        role animal_n logger_n     species   sex       lon      lat
##       &lt;chr&gt;    &lt;int&gt;    &lt;int&gt;       &lt;chr&gt; &lt;chr&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 displacee       11        4 House Finch     F -120.3624 50.66896
## 2 displacer       11        4 House Finch     F -120.3624 50.66896
## 3 displacee       11        4 House Finch     F -120.3624 50.66896
## 4 displacer       11        4 House Finch     F -120.3624 50.66896
## 5 displacee       11        4 House Finch     F -120.3624 50.66896
## 6 displacer       11        4 House Finch     F -120.3624 50.66896</code></pre>
<p>The <code>displacements</code> item is a data frame containing information on each displacement event</p>
<ul>
<li><code>animal_id</code> id of an animal involved in a displacement event</li>
<li><code>date</code> the date of the start of the event</li>
<li><code>left</code> the time the ‘displacee’ left the logger</li>
<li><code>arrrived</code> the time the ‘displacer’ arrived at the logger</li>
<li><code>logger_id</code> the logger involved in the event</li>
<li><code>role</code> the role in the event of the current animal (‘displacee’ or ‘displacer’)</li>
</ul>
<p><code>animal_n</code>, <code>logger_n</code>, <code>species</code>, <code>sex</code>, <code>lon</code>, and <code>lat</code> are extra columns passed through (see <a href="#visitsdata">visits data</a> for more information).</p>
<pre class="r"><code>head(d$summaries)</code></pre>
<pre><code>## # A tibble: 6 × 4
##    animal_id displacee displacer     p_win
##       &lt;fctr&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 0620000500        17        44 0.7213115
## 2 06200004F8        39        24 0.3809524
## 3 06200003AA         6         3 0.3333333
## 4 0620000400         3         1 0.2500000
## 5 0620000477         9         2 0.1818182
## 6 041868E9A8         0         0       NaN</code></pre>
<p>The <code>summaries</code> item is a data frame summarizing the displacement events for each individual</p>
<ul>
<li><code>animal_id</code> id of animal</li>
<li><code>displacee</code> is the number of times the animal was the displacee</li>
<li><code>displacer</code> is the number of times the animal was the displacer</li>
<li><code>p_win</code> is the proportion of times the animal ‘won’ the interaction (i.e. number of displacer events divided by total interactions)</li>
</ul>
<pre class="r"><code>head(d$interactions)</code></pre>
<pre><code>## # A tibble: 6 × 3
##    displacer  displacee     n
##       &lt;fctr&gt;     &lt;fctr&gt; &lt;dbl&gt;
## 1 0620000500 041868E9A8     0
## 2 0620000500 041869123C     0
## 3 0620000500 06200003AA     1
## 4 0620000500 0620000400     1
## 5 0620000500 062000043E     0
## 6 0620000500 0620000477     5</code></pre>
<p>The <code>interactions</code> item is a data frame summarizing each potential interaction event. This is what’s used to create a dominance matrix (see <a href="#dom"><code>dom()</code> function</a> below):</p>
<ul>
<li><code>displacer</code> is id of the animal doing the displacement</li>
<li><code>displacee</code> is id of the animal being displaced</li>
<li><code>n</code> is the number of times that particular combination of displacer and displacee was observed</li>
</ul>
</div>
<div id="no-events" class="section level3">
<h3>No events</h3>
<p>If there are no displacement events in your data set, the function will give you a message and will return an empty list. In this case, the data set is so small, there are no displacement events:</p>
<pre class="r"><code>v &lt;- visits(finches, bw = 5)
disp(v)</code></pre>
<pre><code>## There are no displacement events with a bw = 5</code></pre>
<pre><code>## $displacements
## data frame with 0 columns and 0 rows
## 
## $summaries
## data frame with 0 columns and 0 rows
## 
## $interactions
## data frame with 0 columns and 0 rows</code></pre>
</div>
<div id="bw-2" class="section level3">
<h3><code>bw</code></h3>
<p>The <code>disp()</code> function also contains a <code>bw</code> argument. In this case it reflects the maximum interval between the first animal leaving and the second animal arriving for an interaction to be considered a displacement:</p>
<pre class="r"><code>v &lt;- visits(finches_lg, bw = 5)
head(disp(v)$summaries)</code></pre>
<pre><code>## # A tibble: 6 × 4
##    animal_id displacee displacer     p_win
##       &lt;fctr&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 0620000500        17        44 0.7213115
## 2 06200004F8        39        24 0.3809524
## 3 06200003AA         6         3 0.3333333
## 4 0620000400         3         1 0.2500000
## 5 0620000477         9         2 0.1818182
## 6 041868E9A8         0         0       NaN</code></pre>
<pre class="r"><code>head(disp(v, bw = 10)$summaries)</code></pre>
<pre><code>## # A tibble: 6 × 4
##    animal_id displacee displacer     p_win
##       &lt;fctr&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 041868E9A8         0         2 1.0000000
## 2 0620000500        25        56 0.6913580
## 3 06200004F8        48        33 0.4074074
## 4 06200003AA         8         3 0.2727273
## 5 0620000400         3         1 0.2500000
## 6 0620000477        11         3 0.2142857</code></pre>
<pre class="r"><code>head(disp(v, bw = 15)$summaries)</code></pre>
<pre><code>## # A tibble: 6 × 4
##    animal_id displacee displacer     p_win
##       &lt;fctr&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 041868E9A8         0         3 1.0000000
## 2 0620000500        29        65 0.6914894
## 3 06200004F8        57        37 0.3936170
## 4 06200003AA         9         5 0.3571429
## 5 0620000400         3         1 0.2500000
## 6 0620000477        12         3 0.2000000</code></pre>
<p>However, an interval of 15s is pretty long and probably doesn’t constitute a real displacement event.</p>
</div>
<div id="summarizing-3" class="section level3">
<h3>Summarizing</h3>
<p>Is one logger more contentious than others?</p>
<pre class="r"><code>v &lt;- visits(finches_lg, bw = 5)
d &lt;- disp(v)

disp_summary &lt;- d$displacements %&gt;%
  group_by(logger_id, role) %&gt;%
  count() %&gt;%
  filter(role == &quot;displacer&quot;)

ggplot(data = disp_summary, aes(x = logger_id, y = n)) +
  geom_bar(stat = &quot;identity&quot;)</code></pre>
<p><img src="transformations_files/figure-html/unnamed-chunk-35-1.png" width="768" /></p>
<p>What if we control for overall logger use?</p>
<pre class="r"><code>disp_summary &lt;- d$displacements %&gt;%
  group_by(logger_id, role) %&gt;%
  count() %&gt;%
  filter(role == &quot;displacer&quot;)

presence_summary &lt;- p %&gt;%
  group_by(logger_id) %&gt;%
  summarize(amount = sum(length))

full_summary &lt;- full_join(disp_summary, presence_summary, by = &quot;logger_id&quot;) %&gt;%
  mutate(n = replace(n, is.na(n), 0),  # First replace the missing values of n with 0
         n_per_hour = n / amount * 60) # Calculate the number of interactions as an hourly rate

full_summary</code></pre>
<pre><code>## Source: local data frame [4 x 5]
## Groups: logger_id [4]
## 
##   logger_id      role     n      amount n_per_hour
##      &lt;fctr&gt;     &lt;chr&gt; &lt;dbl&gt;       &lt;dbl&gt;      &lt;dbl&gt;
## 1      2100 displacer    33 1753.600000   1.129106
## 2      2700 displacer    41 1915.250000   1.284428
## 3      2200      &lt;NA&gt;     0  409.550000   0.000000
## 4      2400      &lt;NA&gt;     0    2.033333   0.000000</code></pre>
<pre class="r"><code>ggplot(data = full_summary, aes(x = logger_id, y = n)) +
  geom_bar(stat = &quot;identity&quot;)</code></pre>
<p><img src="transformations_files/figure-html/unnamed-chunk-36-1.png" width="768" /></p>
<pre class="r"><code>d$summaries</code></pre>
<pre><code>## # A tibble: 11 × 4
##     animal_id displacee displacer     p_win
##        &lt;fctr&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1  0620000500        17        44 0.7213115
## 2  06200004F8        39        24 0.3809524
## 3  06200003AA         6         3 0.3333333
## 4  0620000400         3         1 0.2500000
## 5  0620000477         9         2 0.1818182
## 6  041868E9A8         0         0       NaN
## 7  041869123C         0         0       NaN
## 8  062000043E         0         0       NaN
## 9  0620000513         0         0       NaN
## 10 0620000514         0         0       NaN
## 11 0620000520         0         0       NaN</code></pre>
<pre class="r"><code>ggplot(data = d$summaries, aes(x = animal_id, y = p_win)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) + #rotate and shift id labels
  geom_bar(stat = &quot;identity&quot;) +
  ylim(c(0, 1)) +
  labs(x = &quot;Animal Id&quot;, y = &quot;Proportion of &#39;wins&#39;&quot;)</code></pre>
<pre><code>## Warning: Removed 6 rows containing missing values (position_stack).</code></pre>
<p><img src="transformations_files/figure-html/unnamed-chunk-37-1.png" width="768" /></p>
<table>
<tbody>
<tr class="odd">
<td align="left">Back to <a href="#top">top</a></td>
</tr>
</tbody>
</table>
<p><a id = "dominance"></a></p>
</div>
</div>
<div id="dom" class="section level2">
<h2><code>dom()</code></h2>
<p>This function is designed to turn ‘Displacement’ data into a ‘Dominance matrix’.</p>
<p>A <strong>Dominance matrix</strong> is a matrix ranking individuals by wins and losses against other individuals. This matrix can be used to determine the final dominance hierarchy of a group of animals.</p>
<p>This function produces a dominance matrix which represents a ‘best guess’, as opposed to a perfect final product. The function attempts to find the best ordering, with the fewest reversals. A reversal is when an individual loses or wins more against one particular individual than expected given the general pattern of dominance wins/losses (i.e., a generally dominant individual that that has many losses against a generally subdomiant individual)</p>
<p>This matrix should not be considered a final product, but a starting point for manual manipulation, particularly if the function returns more than one ‘best guess’ matrix.</p>
<p>These matrices are created by :</p>
<ul>
<li>Ranking individuals based on their overall win rate</li>
<li>Attempting to fix ‘reversals’ by switching individuals around, and testing whether this reduced the total number of reversals or not.</li>
<li>After so many rounds of trying to reduce reversals, the script returns the best matrix</li>
</ul>
<pre class="r"><code>v &lt;- visits(finches_lg, bw = 5)
d &lt;- disp(v)
dm &lt;- dom(d)</code></pre>
<pre><code>## animal_ids with fewer than 3 interactions have been omitted: 041868E9A8, 041869123C, 062000043E, 0620000513, 0620000514, 0620000520</code></pre>
<pre><code>## Tried 1 times. Found 1 &#39;best&#39; matrix(ces), each with 0 reversal(s)</code></pre>
<pre class="r"><code>names(dm)</code></pre>
<pre><code>## [1] &quot;dominance&quot; &quot;reversals&quot; &quot;matrices&quot;</code></pre>
<div id="data-returned-4" class="section level3">
<h3>Data returned</h3>
<p>The <code>dom()</code> function returns a list with three different types of information: <code>dominance</code>, <code>reversals</code>, and <code>matrices</code>.</p>
<p>However, the first thing this function returns is some information on what happened when the dominance matrix was created:</p>
<pre><code>## animal_ids with fewer than 3 interactions have been omitted: 041868E9A8, 041869123C, 062000043E, 0620000513, 0620000514, 0620000520</code></pre>
<p>This message informs the user that several individuals have been omitted from the analysis because they contained fewer than 3 interactions each. This cutoff value can be customized (see <code>omit_cutoff</code> below).</p>
<pre><code>## Tried 1 times. Found 1 &#39;best&#39; matrix(ces), each with 0 reversal(s)</code></pre>
<p>The next message informs the user about the number iterations the function went through and the number of potential dominance matrices and reversals per matrix. It is possible that several different dominance rankings can be obtained that are equally likely. In this case, <code>dom()</code> will return them all (<code>n 'best' matrix(ces)</code>). Matrices are considered ‘better’ if they have fewer reversals. Furthermore, there may be one or more reversals per matrix.</p>
<pre class="r"><code>dm$dominance</code></pre>
<pre><code>## [[1]]
## [1] &quot;0620000500&quot; &quot;06200004F8&quot; &quot;06200003AA&quot; &quot;0620000400&quot; &quot;0620000477&quot;</code></pre>
<p>The <code>dominance</code> item is a vector containing the dominance hierarchy for each matrix listing all animals from most to least dominant (according to that matrix). Essentially, if the matrix is perfect, this is the dominance hierarchy you have. However, if you need to tweak your matrix, you’ll come up with a different dominance hierarchy.</p>
<pre class="r"><code>v_c &lt;- visits(chickadees, bw = 5)
d_c &lt;- disp(v_c)
dm_c &lt;- dom(d_c)

head(dm_c$reversals[[1]])</code></pre>
<pre><code>##   animal_id1 animal_id2
## 1 0700EE0E42 0700EE022B
## 2 0700EE0E42 062000014F
## 3 062000038D 062000014F
## 4 0620000418 062000038F
## 5 0700EE022B 06200004BE
## 6 062000038D 06200003C3</code></pre>
<p>Our original analysis doesn’t have any reversals, meaning that the matrix of interactions reflects a linear hierarchy (or individuals are tied). However, a look at dominance in our chickadee data set shows many reversals. The <code>reversals</code> item is a list containing a data frame for each matrix showing which individuals experienced reversals with whom: Pairs of individuals which could be switched either way in the hierarchy.</p>
<pre class="r"><code>dm$matrices[[1]]</code></pre>
<pre><code>##            0620000500 06200004F8 06200003AA 0620000400 0620000477
## 0620000500         NA         37          1          1          5
## 06200004F8         15         NA          5          1          3
## 06200003AA          1          2         NA          0          0
## 0620000400          0          0          0         NA          1
## 0620000477          1          0          0          1         NA</code></pre>
<p>The <code>matrix</code> item is a list containing each dominance matrix showing all interactions. The <code>displacers</code> are along the rows, and <code>displacees</code> along the columns. For example, <code>0620000500</code> displaced <code>06200004F8</code> 37 times, whereas <code>06200004F8</code> only displaced <code>0620000500</code> 15 times. <code>0620000500</code> displaced <code>0620000477</code> 5 times, but was only displaced in turn once.</p>
</div>
<div id="tries" class="section level3">
<h3><code>tries</code></h3>
<p>The <code>tries</code> parameter reflect the maximum number of iterations the <code>dom()</code> function should try before returning the matrix. It defaults to 50.</p>
</div>
<div id="omit_cutoff" class="section level3">
<h3><code>omit_cutoff</code></h3>
<p>Sometimes individuals simply don’t participate in enough dominance interactions for their ranking to be assessed. This parameter allows you to set how many interactions an individual must have to be included in the dominance matrix. It defaults to a minimum of 3 but can be increased for a more robust matrix.</p>
<pre class="r"><code>dom(d, omit_cutoff = 10)</code></pre>
<pre><code>## animal_ids with fewer than 10 interactions have been omitted: 06200003AA, 0620000400, 041868E9A8, 041869123C, 062000043E, 0620000513, 0620000514, 0620000520</code></pre>
<pre><code>## Tried 1 times. Found 1 &#39;best&#39; matrix(ces), each with 0 reversal(s)</code></pre>
<pre><code>## $dominance
## $dominance[[1]]
## [1] &quot;0620000500&quot; &quot;06200004F8&quot; &quot;0620000477&quot;
## 
## 
## $reversals
## list()
## 
## $matrices
## $matrices[[1]]
##            0620000500 06200004F8 0620000477
## 0620000500         NA         37          5
## 06200004F8         15         NA          3
## 0620000477          1          0         NA</code></pre>
<table>
<tbody>
<tr class="odd">
<td align="left">Back to <a href="#top">top</a></td>
</tr>
</tbody>
</table>
<p><a id = "activity"></a></p>
</div>
</div>
<div id="activity" class="section level2">
<h2><code>activity()</code></h2>
<p>This function scores individuals as either active or inactive based on their presence data. While simply looking at the presence bouts is a good proxy for active/inactive, scoring intervals as active/inactive allows for easier plotting as well as for averaging over days to create daily activity patterns (see <a href="#dailyactivity"><code>daily()</code> function</a>).</p>
<pre class="r"><code>v &lt;- visits(finches_lg, bw = 5)
p &lt;- presence(v)
a &lt;- activity(p, res = 5)</code></pre>
<pre><code>## 041868E9A8: Active less than 5% of the total time period...</code></pre>
<pre><code>## 041869123C: Skipping. Individual has less than 24hrs of data</code></pre>
<pre><code>## 06200003AA: Active less than 5% of the total time period...</code></pre>
<pre><code>## 06200003AA: 69.7% of obs are shorter than &#39;res&#39; (5 min). Median obs is 3.26 min.</code></pre>
<pre><code>## 0620000400: Active less than 5% of the total time period...</code></pre>
<pre><code>## 0620000400: 62.5% of obs are shorter than &#39;res&#39; (5 min). Median obs is 1.14 min.</code></pre>
<pre><code>## 062000043E: Skipping. Individual has less than 24hrs of data</code></pre>
<pre><code>## 0620000477: Active less than 5% of the total time period...</code></pre>
<pre><code>## 06200004F8: Active less than 5% of the total time period...</code></pre>
<pre><code>## 06200004F8: 52.96% of obs are shorter than &#39;res&#39; (5 min). Median obs is 4.57 min.</code></pre>
<pre><code>## 0620000500: Active less than 5% of the total time period...</code></pre>
<pre><code>## 0620000500: 67.33% of obs are shorter than &#39;res&#39; (5 min). Median obs is 3.46 min.</code></pre>
<pre><code>## 0620000513: Skipping. Individual has less than 24hrs of data</code></pre>
<pre><code>## 0620000514: Active less than 5% of the total time period...</code></pre>
<pre><code>## 0620000514: 75% of obs are shorter than &#39;res&#39; (5 min). Median obs is 1.59 min.</code></pre>
<pre><code>## 0620000520: Active less than 5% of the total time period...</code></pre>
<pre class="r"><code>head(a)</code></pre>
<pre><code>## # A tibble: 6 × 12
##    animal_id       date                time activity activity_c logger_id
##       &lt;fctr&gt;     &lt;date&gt;              &lt;dttm&gt;    &lt;dbl&gt;     &lt;fctr&gt;    &lt;fctr&gt;
## 1 041868E9A8 2015-10-01 2015-10-01 00:00:00        0   inactive        NA
## 2 041868E9A8 2015-10-01 2015-10-01 00:05:00        0   inactive        NA
## 3 041868E9A8 2015-10-01 2015-10-01 00:10:00        0   inactive        NA
## 4 041868E9A8 2015-10-01 2015-10-01 00:15:00        0   inactive        NA
## 5 041868E9A8 2015-10-01 2015-10-01 00:20:00        0   inactive        NA
## 6 041868E9A8 2015-10-01 2015-10-01 00:25:00        0   inactive        NA
##                  rise                 set animal_n logger_n     species
##                &lt;dttm&gt;              &lt;dttm&gt;    &lt;int&gt;    &lt;int&gt;       &lt;chr&gt;
## 1 2015-10-01 07:01:35 2015-10-01 18:39:43       11        4 House Finch
## 2 2015-10-01 07:01:35 2015-10-01 18:39:43       11        4 House Finch
## 3 2015-10-01 07:01:35 2015-10-01 18:39:43       11        4 House Finch
## 4 2015-10-01 07:01:35 2015-10-01 18:39:43       11        4 House Finch
## 5 2015-10-01 07:01:35 2015-10-01 18:39:43       11        4 House Finch
## 6 2015-10-01 07:01:35 2015-10-01 18:39:43       11        4 House Finch
##     sex
##   &lt;chr&gt;
## 1     F
## 2     F
## 3     F
## 4     F
## 5     F
## 6     F</code></pre>
<div id="data-returned-5" class="section level3">
<h3>Data returned</h3>
<p>Several messages along with a data set containing:</p>
<ul>
<li><code>animal_id</code> id of the animal in question</li>
<li><code>date</code> the date of the event</li>
<li><code>time</code> the time block of the event</li>
<li><code>activity</code> a numeric activity score: 0 (inactive), 1 (active)</li>
<li><code>activity_c</code> a categorical activity score: inactive, active</li>
<li><code>logger_id</code> the logger where the activity occurred. If summarizing across loggers, this will be <code>NA</code>.</li>
<li><code>rise</code> the time of sunrise (median time if calculated across all loggers), only calculated if <code>sun = TRUE</code></li>
<li><code>set</code> the time of sunset (median time if calculated across all loggers), only calculated if <code>sun = TRUE</code></li>
</ul>
<p><code>animal_n</code>, <code>logger_n</code>, <code>species</code>, <code>sex</code> are extra columns passed through (see <a href="#visitsdata">visits data</a> for more information).</p>
<p>The messages reflect information regarding the quality of the activity data:</p>
<ul>
<li>activity being low (“Active less than 5%…”)</li>
<li>skipped individuals (“Skipping. Individual has less than 24hrs data) (see <code>keep_all</code> below)</li>
<li>obs which are shorter than the resolution ‘res’ (X% of obs are shorter than ‘res’) (see <code>res</code> below)</li>
</ul>
</div>
<div id="res" class="section level3">
<h3><code>res</code></h3>
<p>The default function calculates activity for each animal at a resolution of 15min. Meaning that every 15min an individual is scored as active or inactive. However, if individuals make short and infrequency visits to a logger, periods of activity may be missed if the active bouts are smaller than the resolution. Resolution can be adjusted through the <code>res</code> argument (note the change in time, and the change in messages).</p>
<pre class="r"><code>head(activity(p, res = 1))</code></pre>
<pre><code>## # A tibble: 6 × 12
##    animal_id       date                time activity activity_c logger_id
##       &lt;fctr&gt;     &lt;date&gt;              &lt;dttm&gt;    &lt;dbl&gt;     &lt;fctr&gt;    &lt;fctr&gt;
## 1 041868E9A8 2015-10-01 2015-10-01 00:00:00        0   inactive        NA
## 2 041868E9A8 2015-10-01 2015-10-01 00:01:00        0   inactive        NA
## 3 041868E9A8 2015-10-01 2015-10-01 00:02:00        0   inactive        NA
## 4 041868E9A8 2015-10-01 2015-10-01 00:03:00        0   inactive        NA
## 5 041868E9A8 2015-10-01 2015-10-01 00:04:00        0   inactive        NA
## 6 041868E9A8 2015-10-01 2015-10-01 00:05:00        0   inactive        NA
##                  rise                 set animal_n logger_n     species
##                &lt;dttm&gt;              &lt;dttm&gt;    &lt;int&gt;    &lt;int&gt;       &lt;chr&gt;
## 1 2015-10-01 07:01:35 2015-10-01 18:39:43       11        4 House Finch
## 2 2015-10-01 07:01:35 2015-10-01 18:39:43       11        4 House Finch
## 3 2015-10-01 07:01:35 2015-10-01 18:39:43       11        4 House Finch
## 4 2015-10-01 07:01:35 2015-10-01 18:39:43       11        4 House Finch
## 5 2015-10-01 07:01:35 2015-10-01 18:39:43       11        4 House Finch
## 6 2015-10-01 07:01:35 2015-10-01 18:39:43       11        4 House Finch
##     sex
##   &lt;chr&gt;
## 1     F
## 2     F
## 3     F
## 4     F
## 5     F
## 6     F</code></pre>
</div>
<div id="by_logger" class="section level3">
<h3><code>by_logger</code></h3>
<p>By default, the <code>activity()</code> function sums all activity across loggers. However, if you wish to calculate separate activity patterns for different loggers, you can set <code>by_logger = TRUE</code>. Note the <code>logger_id</code> and that there are now 4 observations per time block for each individual:</p>
<pre class="r"><code>head(activity(p, by_logger = TRUE))</code></pre>
<pre><code>## # A tibble: 6 × 14
##    animal_id       date                time activity activity_c logger_id
##       &lt;fctr&gt;     &lt;date&gt;              &lt;dttm&gt;    &lt;dbl&gt;     &lt;fctr&gt;    &lt;fctr&gt;
## 1 041868E9A8 2015-10-01 2015-10-01 00:00:00        0   inactive      2100
## 2 041868E9A8 2015-10-01 2015-10-01 00:00:00        0   inactive      2200
## 3 041868E9A8 2015-10-01 2015-10-01 00:00:00        0   inactive      2400
## 4 041868E9A8 2015-10-01 2015-10-01 00:00:00        0   inactive      2700
## 5 041868E9A8 2015-10-01 2015-10-01 00:15:00        0   inactive      2100
## 6 041868E9A8 2015-10-01 2015-10-01 00:15:00        0   inactive      2200
##                  rise                 set animal_n logger_n species   sex
##                &lt;dttm&gt;              &lt;dttm&gt;    &lt;int&gt;    &lt;int&gt;   &lt;chr&gt; &lt;chr&gt;
## 1 2015-10-01 07:01:35 2015-10-01 18:39:43       NA       NA    &lt;NA&gt;     F
## 2 2015-10-01 07:01:35 2015-10-01 18:39:43       NA       NA    &lt;NA&gt;     F
## 3 2015-10-01 07:01:35 2015-10-01 18:39:43       NA       NA    &lt;NA&gt;     F
## 4 2015-10-01 07:01:35 2015-10-01 18:39:43       NA       NA    &lt;NA&gt;     F
## 5 2015-10-01 07:01:35 2015-10-01 18:39:43       NA       NA    &lt;NA&gt;     F
## 6 2015-10-01 07:01:35 2015-10-01 18:39:43       NA       NA    &lt;NA&gt;     F
##         lon      lat
##       &lt;dbl&gt;    &lt;dbl&gt;
## 1 -120.3624 50.66896
## 2 -120.3612 50.66778
## 3 -120.3635 50.66938
## 4 -120.3632 50.66909
## 5 -120.3624 50.66896
## 6 -120.3612 50.66778</code></pre>
</div>
<div id="sun" class="section level3">
<h3><code>sun</code></h3>
<p>By default sunrise and sunset times are calculated if the data contains latitude and longitude information. You can turn this off with <code>sun = FALSE</code>.</p>
</div>
<div id="keep_all" class="section level3">
<h3><code>keep_all</code></h3>
<p>By default, the <code>activity()</code> function skips individuals with less than 24hrs of data, you can force it to retain all individuals by specifying <code>keep_all = TRUE</code>.</p>
</div>
<div id="missing" class="section level3">
<h3><code>missing</code></h3>
<p>Currently this functionality is not implemented. However, eventually we plan to allow users to specify times of known missing data, so that activity can be specified as ‘active’, ‘inactive’, or ‘unknown’.</p>
</div>
<div id="summarizing-4" class="section level3">
<h3>Summarizing</h3>
<p>Activity patterns can be plotted in ggplot2. Let’s look at a specific time period:</p>
<pre class="r"><code>library(dplyr)
library(ggplot2)
library(lubridate)

# Filter by date and animal ID, create a &quot;day&quot; column
sept &lt;- a %&gt;%
  filter(date &gt;= as.Date(&quot;2015-09-21&quot;),
         date &lt; as.Date(&quot;2015-09-28&quot;),
         animal_id == &quot;06200004F8&quot;)

# Use facet_wrap to look at individual days, use drop = TRUE to omit days without activity
ggplot(data = sept, aes(x = time, y = activity)) +
  facet_wrap(~ date, scales = &quot;free_x&quot;, ncol = 1, drop = TRUE) +
  geom_area()</code></pre>
<p><img src="transformations_files/figure-html/unnamed-chunk-47-1.png" width="768" /></p>
<p>There’s a clear daily pattern, but it’s a bit hard to tell without sunrise and sunset:</p>
<pre class="r"><code>sun &lt;- unique(select(sept, rise, set, date))

ggplot(data = sept, aes(x = time, y = activity)) +
  facet_wrap(~ date, scales = &quot;free_x&quot;, ncol = 1, drop = TRUE) +
  geom_rect(mapping = aes(xmax = rise), xmin = -Inf, ymin = -Inf, ymax = +Inf, fill = &quot;grey&quot;) +
  geom_rect(mapping = aes(xmin = set), xmax = +Inf, ymin = -Inf, ymax = +Inf, fill = &quot;grey&quot;) +
  geom_area()</code></pre>
<p><img src="transformations_files/figure-html/unnamed-chunk-48-1.png" width="768" /></p>
<table>
<tbody>
<tr class="odd">
<td align="left">Back to <a href="#top">top</a></td>
</tr>
</tbody>
</table>
<p><a id = "dailyactivity"></a></p>
</div>
</div>
<div id="daily" class="section level2">
<h2><code>daily()</code></h2>
<p><code>daily()</code> converts activity patterns created by the <a href="#activity"><code>activity()</code> function</a> to averaged daily activity patterns.</p>
<pre class="r"><code>v &lt;- visits(finches_lg, bw = 5)
p &lt;- presence(v)
a &lt;- activity(p, res = 5)
da &lt;- daily(a)</code></pre>
<div id="data-returned-6" class="section level3">
<h3>Data returned</h3>
<p>A data set containing:</p>
<ul>
<li><code>animal_id</code> id of the animal in question</li>
<li><code>time</code> the time block of the event (note the odd date)</li>
<li><code>time_c</code> the time block of the event (categorical)</li>
<li><code>p_active</code> the proportion of times this block was scored as active</li>
<li><code>p_inactive</code> the proportion of times this block was scored as inactive</li>
<li><code>p_unknown</code> the proportion of times this block was scored as unknown</li>
<li><code>p_total</code> the proportion of times this block was scored as anything but unknown (i.e., 1 - <code>p_unknown</code>)</li>
<li><code>logger_id</code> the logger where the activity occurred. If summarizing across loggers, this will be <code>NA</code>.</li>
<li><code>rise</code> the time of sunrise (median time if calculated across all loggers), only calculated if <code>sun = TRUE</code></li>
<li><code>set</code> the time of sunset (median time if calculated across all loggers), only calculated if <code>sun = TRUE</code></li>
</ul>
<p><code>animal_n</code>, <code>logger_n</code>, <code>species</code>, <code>sex</code> are extra columns passed through (see <a href="#visitsdata">visits data</a> for more information).</p>
<p>If missing data are indicated in <code>activity()</code>, then the proportion of unknown blocks will be greater than 0 (Note that this is not currently available).</p>
</div>
<div id="summarizing-5" class="section level3">
<h3>Summarizing</h3>
<p>Daily activity patterns can be plotted by hiding the date portion of the time stamp.</p>
<pre class="r"><code>ggplot(data = da, aes(x = time, y = p_active)) +
  geom_rect(aes(xmax = rise), xmin = -Inf, ymin = -Inf, ymax = +Inf, fill = &quot;grey&quot;) +
  geom_rect(aes(xmin = set), xmax = +Inf, ymin = -Inf, ymax = +Inf, fill = &quot;grey&quot;) +
  geom_area() +
  facet_wrap(~ animal_id) +
  scale_x_datetime(date_labels = &quot;%H:%M:%S&quot;, date_breaks = &quot;6 hours&quot;)</code></pre>
<p><img src="transformations_files/figure-html/unnamed-chunk-49-1.png" width="768" /></p>
<p>Note also that this script repeats the drawing of the sunrise/sunset rectangles, making it difficult to use alpha values. To avoid this, create a reduced data frame with only sunrise/sunset data:</p>
<pre class="r"><code>sun &lt;- unique(da[, c(&quot;rise&quot;, &quot;set&quot;, &quot;animal_id&quot;)])

ggplot(data = da) +
  geom_rect(data = sun, aes(xmax = rise), xmin = -Inf, ymin = -Inf, ymax = +Inf, fill = &quot;black&quot;, alpha = 0.1) +
  geom_rect(data = sun, aes(xmin = set), xmax = +Inf, ymin = -Inf, ymax = +Inf, fill = &quot;black&quot;, alpha = 0.1) +
  geom_area(aes(x = time, y = p_active)) +
  facet_wrap(~ animal_id) +
  scale_x_datetime(date_labels = &quot;%H:%M:%S&quot;, date_breaks = &quot;6 hours&quot;)</code></pre>
<p><img src="transformations_files/figure-html/unnamed-chunk-50-1.png" width="768" /></p>
<hr />
<p>Back to <a href="#top">top</a><br />
Go back to <a href="index.html">home</a> | Go back to <a href="housekeeping.html">housekeeping</a> | Continue with <a href="maps.html">visualizations</a></p>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
